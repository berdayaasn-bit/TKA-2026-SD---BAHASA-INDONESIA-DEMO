<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo TKA SD Kelas 6 - Belajar Sukses</title>
    <style>
        :root {
            var(--bg-blue-login): #185093;
            --btn-navy: #0E3A75;
            --accent-gold: #D7A83B;
            --bg-light: #EEF2F6;
            --card-bg: #FFFFFF;
            --text-dark: #333333;
            --text-muted: #666666;
            --border-light: #D1D5DB;
            --option-bg: #EFEFEF;
        }

        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-light);
            color: var(--text-dark);
            min-height: 100vh;
        }

        .hidden { display: none !important; }

        /* =========================================
           1. HALAMAN LOGIN
           ========================================= */
        #login-page {
            background-color: #185093;
            min-height: 100vh;
            display: flex; justify-content: center; align-items: center; padding: 20px;
        }

        .login-card {
            background: var(--card-bg); width: 100%; max-width: 420px; border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3); text-align: center; padding: 40px 30px;
            border-top: 5px solid var(--accent-gold);
        }

        .login-card h2 { color: var(--btn-navy); font-size: 1.3em; font-weight: 800; margin-bottom: 15px; line-height: 1.4; }
        .login-card p { font-size: 0.9em; color: var(--text-muted); margin-bottom: 25px; }

        .input-group { position: relative; margin-bottom: 25px; text-align: left; }
        .input-group input { width: 100%; padding: 12px 60px 12px 15px; border: 1px solid var(--border-light); border-radius: 6px; font-size: 14px; outline: none; }
        .input-group input:focus { border-color: var(--btn-navy); }

        .toggle-password { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--btn-navy); font-weight: bold; font-size: 0.85em; }
        .btn-login { background: var(--accent-gold); color: var(--btn-navy); border: none; width: 100%; padding: 14px; border-radius: 6px; font-size: 15px; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .btn-login:hover { filter: brightness(0.95); }

        /* =========================================
           2. HALAMAN KUIS
           ========================================= */
        #quiz-page { display: flex; flex-direction: column; min-height: 100vh; }

        .header { background: var(--btn-navy); color: var(--accent-gold); padding: 10px 25px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .header h1 { font-size: 1.2em; font-weight: 800; text-transform: uppercase; }
        .timer-pill { background: #FFFFFF; color: var(--btn-navy); padding: 6px 15px; border-radius: 20px; font-weight: bold; font-size: 0.95em; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        .quiz-container { display: flex; gap: 20px; padding: 20px; max-width: 1300px; margin: 0 auto; width: 100%; flex-grow: 1; align-items: flex-start; }

        .main-content { flex: 1; background: var(--card-bg); border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .card-header { padding: 15px 25px; border-bottom: 2px solid var(--accent-gold); display: flex; justify-content: space-between; align-items: center; }
        .soal-indicator { color: var(--btn-navy); font-weight: 700; font-size: 1em; }
        .tipe-badge { background: var(--accent-gold); color: #5A4011; padding: 4px 12px; border-radius: 12px; font-size: 0.8em; font-weight: bold; }
        .card-body { padding: 25px; flex-grow: 1; }
        .wacana-box { background: #FFF8E1; padding: 15px; border-left: 4px solid var(--accent-gold); margin-bottom: 20px; border-radius: 4px; font-size: 0.95em; line-height: 1.6; }
        .question-text { font-size: 1em; margin-bottom: 25px; line-height: 1.6; }

        /* Opsi PG/PGK */
        .options-container { display: flex; flex-direction: column; gap: 12px; }
        .option-label { display: flex; align-items: center; padding: 12px 20px; background: var(--option-bg); border-radius: 8px; cursor: pointer; border: 1px solid transparent; transition: 0.2s; }
        .option-label:hover { background: #E5E5E5; }
        .option-label input { margin-right: 15px; transform: scale(1.2); accent-color: var(--btn-navy); }
        .option-label.selected { border-color: var(--btn-navy); background: #E6EEF9; }

        /* Tabel Benar/Salah (BS) */
        .bs-table { width: 100%; border-collapse: collapse; margin-top: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .bs-table th, .bs-table td { border: 1px solid var(--border-light); padding: 15px; text-align: center; }
        .bs-table th:first-child, .bs-table td:first-child { text-align: left; }
        .bs-table th { background: var(--btn-navy); color: white; font-weight: 600; padding: 12px; }
        .bs-table tr:nth-child(even) { background-color: #F9FAFB; }
        .bs-radio-label { display: flex; justify-content: center; align-items: center; cursor: pointer; width: 100%; height: 100%; }
        .bs-radio { transform: scale(1.4); accent-color: var(--btn-navy); cursor: pointer; }

        /* Footer Kuis */
        .card-footer { padding: 15px 25px; border-top: 1px solid var(--border-light); display: flex; justify-content: space-between; align-items: center; }
        
        .btn-pembahasan { background: #E5E7EB; color: #4B5563; padding: 10px 15px; border: 1px solid #D1D5DB; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-pembahasan:hover { background: #D1D5DB; }
        
        .btn-next { background: var(--btn-navy); color: white; padding: 10px 20px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s; }

        /* Sidebar Navigasi Grid TERBUKA */
        .sidebar { width: 320px; background: var(--card-bg); border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); padding: 20px; position: relative; flex-shrink: 0; }
        .sidebar h3 { color: var(--btn-navy); text-align: center; font-size: 1.05em; margin-bottom: 10px; }
        .sidebar-divider { height: 1px; background: var(--accent-gold); margin-bottom: 20px; }
        
        .cbt-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .grid-item { aspect-ratio: 1; display: flex; justify-content: center; align-items: center; background: white; border: 1px solid var(--border-light); border-radius: 4px; font-weight: 600; font-size: 0.9em; color: var(--text-dark); cursor: pointer; transition: 0.2s; }
        .grid-item:hover { background: #E6EEF9; }
        .grid-item.active { box-shadow: 0 0 0 3px rgba(14, 58, 117, 0.4); border-color: var(--btn-navy); font-weight: 800; }
        .grid-item.answered { background: #10B981; color: white; border-color: #10B981; }

        /* Alert Merah Pindah Tab */
        #alert-cheat {
            background-color: #DC2626; color: white; text-align: center; padding: 10px;
            font-weight: bold; position: sticky; top: 0; z-index: 999; display: none;
            animation: flash 1s infinite alternate;
        }
        @keyframes flash { from { background-color: #DC2626; } to { background-color: #991B1B; } }

        /* =========================================
           3. HALAMAN HASIL & PAYWALL
           ========================================= */
        #result-page { max-width: 800px; margin: 40px auto; background: white; border-radius: 12px; padding: 40px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }

        /* Score Blur Setup */
        .score-container { position: relative; width: 140px; height: 140px; margin: 0 auto 20px; display: inline-block; }
        .score-circle { width: 100%; height: 100%; border-radius: 50%; background: var(--btn-navy); color: var(--accent-gold); display: flex; justify-content: center; align-items: center; font-size: 3.5em; font-weight: 900; border: 6px solid #E6EEF9; }
        .score-blur { filter: blur(8px); user-select: none; }
        .score-lock { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2.5em; z-index: 10; cursor: pointer; }

        /* Timer Promo Premium */
        .promo-premium { background: #FEF2F2; border: 2px solid #EF4444; border-radius: 12px; padding: 25px; margin: 30px 0; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.2); }
        .promo-premium h3 { color: #B91C1C; margin-bottom: 10px; font-size: 1.4em; text-transform: uppercase; font-weight: 900;}
        .timer-box { font-size: 2.5em; font-weight: 900; color: #DC2626; letter-spacing: 2px; margin: 15px 0; background: white; display: inline-block; padding: 10px 30px; border-radius: 8px; border: 2px dashed #DC2626; }
        
        .btn-upgrade { display: inline-block; background: #DC2626; color: white; padding: 16px 32px; border-radius: 30px; font-size: 1.2em; font-weight: 900; text-decoration: none; animation: blinker 1.5s linear infinite; box-shadow: 0 4px 10px rgba(220, 38, 38, 0.4); }
        @keyframes blinker { 50% { opacity: 0.8; transform: scale(1.05); } }

        .btn-certificate { background: #4B5563; color: white; padding: 12px 25px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
        
        .affiliate-section { text-align: left; margin-top: 40px; padding-top: 30px; border-top: 2px dashed var(--border-light); }
        .book-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .book-card { border: 1px solid var(--border-light); border-radius: 10px; padding: 20px; border-left: 4px solid var(--btn-navy); }
        .btn-buy { display: block; text-align: center; background: #10B981; color: white; text-decoration: none; padding: 12px; border-radius: 6px; font-weight: bold; margin-top: 15px; }
        
        .copyright-footer { margin-top: 50px; padding-top: 20px; border-top: 1px solid var(--border-light); color: var(--text-muted); font-size: 0.9em; }

        @media(max-width: 800px) { .quiz-container { flex-direction: column; } .sidebar { width: 100%; } .book-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div id="alert-cheat">‚ö†Ô∏è PERINGATAN! Anda terdeteksi keluar dari halaman ujian.</div>

<div id="login-page">
    <div class="login-card">
        <h2 id="display-judul-login">TKA SD - BAHASA INDONESIA</h2>
        <p>Masukkan PIN untuk memulai ujian.</p>
        <div class="input-group">
            <input type="password" id="pin-input" placeholder="Masukkan PIN Akses">
            <div class="toggle-password" onclick="togglePassword()">Lihat</div>
        </div>
        <button class="btn-login" onclick="startQuiz()">MULAI UJIAN</button>
    </div>
</div>

<div id="quiz-page" class="hidden">
    <div class="header">
        <h1 id="display-judul-quiz">TKA SD - BAHASA INDONESIA</h1>
        <div class="timer-pill" onclick="alertPremium('Timer')">01:09:58 üîí</div>
    </div>
    
    <div class="quiz-container">
        <div class="main-content">
            <div class="card-header">
                <span class="soal-indicator" id="question-counter">Soal 1 / 30</span>
                <span class="tipe-badge" id="tipe-soal-badge">Tipe: PG</span>
            </div>
            
            <div class="card-body">
                <div id="wacana-container" class="wacana-box hidden"></div>
                <div id="question-text" class="question-text"></div>
                <div id="options-container" class="options-container"></div>
            </div>

            <div class="card-footer">
                <button class="btn-pembahasan" onclick="alertPremium('Pembahasan Lengkap')">üí° Lihat Pembahasan üîí</button>
                <button class="btn-next" id="btn-next" onclick="navQuestion(1)">Soal Selanjutnya ‚ñ∫</button>
            </div>
        </div>

        <aside class="sidebar">
            <h3>Navigasi Soal</h3>
            <div class="sidebar-divider"></div>
            <div id="cbt-grid" class="cbt-grid"></div>
        </aside>
    </div>
</div>

<div id="result-page" class="hidden">
    <h2 id="result-title">Hasil Ujian Trial</h2>
    
    <div class="score-container" onclick="alertPremium('Melihat Nilai Akhir')">
        <div class="score-circle">
            <div class="score-blur" id="final-score">85</div>
        </div>
        <div class="score-lock">üîí</div>
    </div>
    <br>
    
    <button class="btn-certificate" onclick="alertPremium('Cetak Sertifikat')">üñ®Ô∏è Cetak Sertifikat üîí</button>

    <div class="promo-premium">
        <h3>üî• Promo Spesial Terbatas! üî•</h3>
        <p>Buka Nilai Akhir, Akses Pembahasan Lengkap, Cetak Sertifikat, dan Dapatkan RATUSAN Soal TKA lainnya dengan Harga Khusus!</p>
        <div class="timer-box" id="promo-timer">03:00</div>
        <br>
        <a href="#" id="link-premium" class="btn-upgrade" target="_blank">üöÄ KLAIM HARGA SPESIAL SEKARANG</a>
    </div>

    <div class="affiliate-section">
        <h3 style="color:var(--btn-navy);">üìö Rekomendasi Buku Belajar Pilihan</h3>
        <div class="book-grid">
            <div class="book-card">
                <h4 id="buku1-judul" style="color:var(--btn-navy); margin-bottom:8px;"></h4>
                <p id="buku1-desc" style="color:var(--text-muted); font-size:0.9em; flex-grow:1;"></p>
                <a href="#" id="buku1-link" class="btn-buy" target="_blank">üõí Beli Buku Ini</a>
            </div>
            <div class="book-card">
                <h4 id="buku2-judul" style="color:var(--btn-navy); margin-bottom:8px;"></h4>
                <p id="buku2-desc" style="color:var(--text-muted); font-size:0.9em; flex-grow:1;"></p>
                <a href="#" id="buku2-link" class="btn-buy" target="_blank">üõí Beli Buku Ini</a>
            </div>
        </div>
    </div>

    <div class="copyright-footer">
        ¬© 2026 Copyright <b>Belajar Sukses</b>. All Rights Reserved.
    </div>
</div>

<script>
    const JUDUL_KUIS = "TKA SD - BAHASA INDONESIA";
    const PIN_AKSES = "COBA123";
    const TARGET_TOTAL_SOAL = 30; // DIRUBAH MENJADI 30 SOAL
    const LINK_PEMBELIAN_PREMIUM = "https://lynk.id/belajarsukses";

    const BUKU_1_JUDUL = "Buku Super Drilling TKA SD/MI";
    const BUKU_1_DESC = "Kumpulan soal terlengkap dengan pembahasan jitu untuk persiapan ujian.";
    const BUKU_1_LINK = "https://shope.ee/contohlink_buku1";

    const BUKU_2_JUDUL = "Buku Taktik Cerdik Lulus TKA";
    const BUKU_2_DESC = "Berisi ringkasan materi dan life hack cara cepat menjawab soal.";
    const BUKU_2_LINK = "https://shope.ee/contohlink_buku2";

    const RAW_SINGLE = `
[Tipe: PG] "Kemarin sore aku antri cukup lama saat membeli tiket di stasiun," kata paman. Penggunaan kata tidak baku dalam kalimat dialog tersebut jika diperbaiki menjadi kata baku adalah... | Antre ~ Mengantri ~ Antrian ~ Ngantri | A | Kata baku yang benar sesuai Pedoman Umum Ejaan Bahasa Indonesia (PUEBI) adalah "antre".
[Tipe: PG] Di sebuah ekosistem laut yang asri, terdapat terumbu karang yang menjadi rumah bagi berbagai **biota**. Apa makna istilah biologi yang dicetak tebal tersebut? | Sekumpulan tumbuhan laut ~ Seluruh flora dan fauna di wilayah tertentu ~ Jenis ikan hias yang langka ~ Batuan yang ada di dasar laut | B | Biota merujuk pada keseluruhan kehidupan (flora dan fauna) di suatu wilayah. 
[Tipe: PG] Pak Budi adalah **tangan kanan** direktur di perusahaan itu. Makna ungkapan "**tangan kanan**" adalah... | Orang yang kuat ~ Orang kepercayaan ~ Anggota keluarga ~ Orang yang rajin | B | Tangan kanan adalah idiom untuk orang yang sangat dipercaya oleh atasan. 
    `;

    const RAW_CLUSTER = `
###
[WACANA: Keajaiban Metamorfosis Katak] Katak merupakan hewan amfibi yang mengalami siklus hidup unik. Proses ini diawali dari telur yang diletakkan induknya di dalam air. Setelah beberapa hari, telur menetas menjadi kecebong atau berudu yang bernapas dengan insang. Seiring berjalannya waktu, pada kecebong tumbuh kaki belakang, disusul kaki depan, dan ekornya mulai memendek hingga terbentuklah katak muda.
[Tipe: BS] Tentukan benar atau salah pernyataan mengenai siklus hidup katak berdasarkan teks: | Kecebong bernapas menggunakan paru-paru (Salah) ~ Kaki depan tumbuh lebih dulu daripada kaki belakang (Salah) ~ Katak dewasa bernapas dengan paru-paru dan kulit (Benar) | - | Kecebong menggunakan insang, kaki belakang tumbuh lebih dulu, dan dewasa menggunakan paru-paru/kulit. 
###
    `;

    let questionsData = [];
    let currentIndex = 0;
    let userAnswers = {};
    
    // VARIABEL ANTI-CHEAT
    let isQuizActive = false;
    let tabSwitchCount = 0;
    const MAX_TAB_SWITCH = 3;

    function parseMarkdown(text) {
        text = text.replace(/^\d+\.\s*/, '');
        return text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>').replace(/<br>/g, '<br>').replace(/\[IMG:\s*(.*?)\]/g, '<img src="$1" alt="Gambar Soal">');
    }

    function extractQuestions(rawSingle, rawCluster) {
        let tempQuestions = [];
        
        function processMatch(match, wacanaHTML) {
            const parts = match.split('|');
            const type = parts[0].match(/\[Tipe:\s*([A-Z]+)\]/)[1];
            const text = parseMarkdown(parts[0].replace(/\[Tipe:\s*[A-Z]+\]/, '').trim());
            let options = parts[1].trim().split('~').map(o => o.trim());
            const correctKey = parts[2] ? parts[2].trim() : '';

            if (type === 'BS') {
                options = options.map(opt => {
                    const m = opt.match(/(.*?)\s*\((Benar|Salah)\)/i);
                    return m ? { statement: parseMarkdown(m[1].trim()), key: m[2] } : { statement: parseMarkdown(opt), key: '' };
                });
            } else { options = options.map(o => parseMarkdown(o)); }

            tempQuestions.push({ type, wacana: wacanaHTML, text, options, correctKey });
        }

        const singleMatches = rawSingle.match(/\[Tipe:\s*([A-Z]+)\](.*?)\|(.*?)\|(.*?)\|/g);
        if(singleMatches) singleMatches.forEach(m => processMatch(m, null));

        const clusters = rawCluster.split('###').filter(c => c.trim() !== '');
        clusters.forEach(cluster => {
            const wacanaMatch = cluster.match(/\[WACANA:(.*?)\](.*?)(\[Tipe:|$)/s);
            let wacanaHTML = null;
            if(wacanaMatch) wacanaHTML = `<strong>${wacanaMatch[1].trim()}</strong><br>${parseMarkdown(wacanaMatch[2].trim())}`;
            const clusterMatches = cluster.match(/\[Tipe:\s*([A-Z]+)\](.*?)\|(.*?)\|/g);
            if(clusterMatches) clusterMatches.forEach(m => processMatch(m, wacanaHTML));
        });

        // Loop untuk memperbanyak bank soal hingga 30
        let originalLength = tempQuestions.length;
        while(tempQuestions.length < TARGET_TOTAL_SOAL) {
            for(let i = 0; i < originalLength && tempQuestions.length < TARGET_TOTAL_SOAL; i++) {
                tempQuestions.push(tempQuestions[i]);
            }
        }
        return tempQuestions;
    }

    function initApp() {
        document.getElementById('display-judul-login').innerText = JUDUL_KUIS;
        document.getElementById('display-judul-quiz').innerText = JUDUL_KUIS;
        document.getElementById('link-premium').href = LINK_PEMBELIAN_PREMIUM;
        document.getElementById('buku1-judul').innerText = BUKU_1_JUDUL; document.getElementById('buku1-desc').innerText = BUKU_1_DESC; document.getElementById('buku1-link').href = BUKU_1_LINK;
        document.getElementById('buku2-judul').innerText = BUKU_2_JUDUL; document.getElementById('buku2-desc').innerText = BUKU_2_DESC; document.getElementById('buku2-link').href = BUKU_2_LINK;
        questionsData = extractQuestions(RAW_SINGLE, RAW_CLUSTER);
    }

    function togglePassword() {
        const input = document.getElementById('pin-input');
        const toggleBtn = document.querySelector('.toggle-password');
        if(input.type === 'password') { input.type = 'text'; toggleBtn.innerText = 'Sembunyikan'; } 
        else { input.type = 'password'; toggleBtn.innerText = 'Lihat'; }
    }

    function alertPremium(feature) { alert(`Buka versi Premium untuk fitur ${feature}!`); }

    // DETEKSI PINDAH TAB
    document.addEventListener("visibilitychange", () => {
        if (isQuizActive && document.hidden) {
            tabSwitchCount++;
            const alertBox = document.getElementById('alert-cheat');
            
            if (tabSwitchCount >= MAX_TAB_SWITCH) {
                alertBox.style.display = 'none';
                alert("‚ö†Ô∏è DISKUALIFIKASI! Anda telah keluar dari tab ujian sebanyak 3 kali.");
                finishQuiz(true); // Param true untuk mode diskualifikasi
            } else {
                alertBox.innerHTML = `‚ö†Ô∏è PERINGATAN KECURANGAN! (${tabSwitchCount}/${MAX_TAB_SWITCH})<br>Anda terdeteksi keluar dari halaman ujian. Jika mencapai 3 kali, Anda akan didiskualifikasi!`;
                alertBox.style.display = 'block';
                setTimeout(() => { alertBox.style.display = 'none'; }, 4000);
            }
        }
    });

    function startQuiz() {
        const pin = document.getElementById('pin-input').value;
        if(pin !== PIN_AKSES) return alert("PIN Akses salah! (Gunakan: COBA123)");
        document.getElementById('login-page').classList.add('hidden');
        document.getElementById('quiz-page').classList.remove('hidden');
        isQuizActive = true;
        renderGrid(); showQuestion(0);
    }

    function renderGrid() {
        const gridContainer = document.getElementById('cbt-grid'); gridContainer.innerHTML = '';
        for(let i = 0; i < TARGET_TOTAL_SOAL; i++) {
            const item = document.createElement('div'); item.className = 'grid-item'; item.id = `grid-btn-${i}`; item.innerText = i + 1;
            // FITUR LOMPAT NOMOR AKTIF
            item.onclick = () => jumpToQuestion(i);
            gridContainer.appendChild(item);
        }
    }

    function checkAnsweredStatus(index) {
        const q = questionsData[index];
        if (q.type === 'BS') {
            const answeredCount = userAnswers[index] ? Object.keys(userAnswers[index]).length : 0;
            return answeredCount === q.options.length;
        } else if (q.type === 'PGK') {
            return userAnswers[index] && userAnswers[index].length > 0;
        } else {
            return userAnswers[index] !== undefined;
        }
    }

    function updateGridUI() {
        document.querySelectorAll('.grid-item').forEach((el, idx) => {
            el.classList.remove('active');
            if(checkAnsweredStatus(idx)) el.classList.add('answered');
            else el.classList.remove('answered');
        });
        if(document.getElementById(`grid-btn-${currentIndex}`)) document.getElementById(`grid-btn-${currentIndex}`).classList.add('active');
    }

    function showQuestion(index) {
        if(index < 0 || index >= questionsData.length) return;
        currentIndex = index; const q = questionsData[index];
        
        document.getElementById('question-counter').innerText = `Soal ${index + 1} / ${TARGET_TOTAL_SOAL}`;
        document.getElementById('tipe-soal-badge').innerText = `Tipe: ${q.type}`;
        
        updateGridUI();

        const wacanaBox = document.getElementById('wacana-container');
        if(q.wacana) { wacanaBox.innerHTML = q.wacana; wacanaBox.classList.remove('hidden'); } else wacanaBox.classList.add('hidden');
        document.getElementById('question-text').innerHTML = q.text;

        const optContainer = document.getElementById('options-container'); optContainer.innerHTML = '';
        const alphabet = ['A', 'B', 'C', 'D', 'E'];
        
        if (q.type === 'BS') {
            const table = document.createElement('table'); table.className = 'bs-table';
            table.innerHTML = `<thead><tr><th>Pernyataan</th><th width="90">Benar</th><th width="90">Salah</th></tr></thead><tbody></tbody>`;
            const tbody = table.querySelector('tbody');

            q.options.forEach((opt, idx) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${opt.statement}</td>
                    <td><label class="bs-radio-label"><input type="radio" name="bs_${index}_${idx}" value="Benar" class="bs-radio"></label></td>
                    <td><label class="bs-radio-label"><input type="radio" name="bs_${index}_${idx}" value="Salah" class="bs-radio"></label></td>`;
                if(userAnswers[index] && userAnswers[index][idx]) {
                    const input = tr.querySelector(`input[value="${userAnswers[index][idx]}"]`); if(input) input.checked = true;
                }
                tr.querySelectorAll('input').forEach(inp => {
                    inp.addEventListener('change', (e) => {
                        if(!userAnswers[index]) userAnswers[index] = {}; userAnswers[index][idx] = e.target.value; updateGridUI();
                    });
                });
                tbody.appendChild(tr);
            });
            optContainer.appendChild(table);
        } else {
            q.options.forEach((optText, i) => {
                const label = document.createElement('label'); label.className = 'option-label';
                const input = document.createElement('input'); input.name = `soal_${index}`;
                
                if(q.type === 'PGK') { 
                    input.type = 'checkbox'; input.value = alphabet[i]; 
                    if(userAnswers[index] && userAnswers[index].includes(alphabet[i])) { input.checked = true; label.classList.add('selected'); } 
                } else { 
                    input.type = 'radio'; input.value = alphabet[i]; 
                    if(userAnswers[index] === alphabet[i]) { input.checked = true; label.classList.add('selected'); } 
                }

                input.addEventListener('change', (e) => { saveAnswer(index, q.type, e.target); updateGridUI(); });
                label.appendChild(input); label.innerHTML += `<b>${alphabet[i]}.</b>&nbsp;&nbsp;${optText}`;
                optContainer.appendChild(label);
            });
        }

        const btnNext = document.getElementById('btn-next');
        if(index === questionsData.length - 1) { 
            btnNext.innerHTML = 'Selesai Ujian ‚úîÔ∏è'; btnNext.onclick = () => finishQuiz(false); btnNext.style.background = '#10B981'; 
        } else { 
            btnNext.innerHTML = 'Soal Selanjutnya ‚ñ∫'; btnNext.onclick = () => navQuestion(1); btnNext.style.background = 'var(--btn-navy)'; 
        }
    }

    function saveAnswer(index, type, target) {
        if(type === 'PGK') {
            if(!userAnswers[index]) userAnswers[index] = [];
            if(target.checked) userAnswers[index].push(target.value);
            else userAnswers[index] = userAnswers[index].filter(v => v !== target.value);
        } else { userAnswers[index] = target.value; }

        const labels = document.querySelectorAll('.option-label');
        if(type !== 'PGK') labels.forEach(l => l.classList.remove('selected'));
        if(target.checked) target.parentElement.classList.add('selected'); else target.parentElement.classList.remove('selected');
    }

    function validateCurrentBS() {
        const q = questionsData[currentIndex];
        if (q.type === 'BS') {
            const answeredCount = userAnswers[currentIndex] ? Object.keys(userAnswers[currentIndex]).length : 0;
            if (answeredCount > 0 && answeredCount < q.options.length) {
                alert("‚ö†Ô∏è Validasi: Harap selesaikan seluruh pilihan 'Benar/Salah' pada tabel ini terlebih dahulu.");
                return false;
            }
        }
        return true;
    }

    function navQuestion(dir) {
        if (!validateCurrentBS()) return;
        showQuestion(currentIndex + dir); 
    }

    function jumpToQuestion(i) {
        if(i === currentIndex) return;
        if (!validateCurrentBS()) return;
        showQuestion(i);
    }

    // TIMER PROMO 3 MENIT
    function startPromoTimer() {
        let duration = 3 * 60; // 3 Menit
        const timerDisplay = document.getElementById('promo-timer');
        const interval = setInterval(() => {
            let m = Math.floor(duration / 60);
            let s = duration % 60;
            timerDisplay.innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            if (duration <= 0) {
                clearInterval(interval);
                timerDisplay.innerText = "WAKTU HABIS!";
                timerDisplay.style.color = "#6B7280";
                timerDisplay.style.borderColor = "#6B7280";
            }
            duration--;
        }, 1000);
    }

    function finishQuiz(isDisqualified) {
        if (!isDisqualified && !validateCurrentBS()) return;
        if (!isDisqualified && !confirm("Yakin ingin menyelesaikan ujian Demo ini?")) return;
        
        isQuizActive = false; // Stop monitor tab

        let correctCount = 0; let totalQuestions = 0;
        questionsData.forEach((question, i) => { 
            if(question.type === 'PG') { 
                totalQuestions++; if(userAnswers[i] === question.correctKey) correctCount++; 
            } else if (question.type === 'BS') {
                question.options.forEach((opt, idx) => {
                    totalQuestions++; if(userAnswers[i] && userAnswers[i][idx] === opt.key) correctCount++;
                });
            }
        });

        const finalScore = Math.round((correctCount / (totalQuestions || 1)) * 100);
        document.getElementById('final-score').innerText = isDisqualified ? "0" : finalScore;
        
        if (isDisqualified) {
            document.getElementById('result-title').innerText = "‚ùå UJIAN DIDISKUALIFIKASI";
            document.getElementById('result-title').style.color = "#DC2626";
        }

        document.getElementById('quiz-page').classList.add('hidden');
        document.getElementById('result-page').classList.remove('hidden');
        startPromoTimer();
    }

    window.onload = initApp;
</script>

</body>
</html>
