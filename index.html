<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo TKA SD Kelas 6 - Belajar Sukses</title>
    <style>
        :root {
            /* Premium Color Scheme */
            --bg-blue: #1C5196;
            --btn-blue: #163D7A;
            --accent-gold: #D7AE38;
            --bg-light: #F0F2F5;
            --text-dark: #1F2937;
            --text-muted: #6B7280;
            --card-bg: #FFFFFF;
            --border-color: #E5E7EB;
            --option-bg: #F3F4F6;
        }

        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-light);
            color: var(--text-dark);
            min-height: 100vh;
        }

        /* Utility */
        .hidden { display: none !important; }

        /* =========================================
           1. HALAMAN LOGIN
           ========================================= */
        #login-page {
            background-color: var(--bg-blue);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .login-card {
            background: var(--card-bg);
            width: 100%;
            max-width: 450px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            overflow: hidden;
            text-align: center;
            padding: 40px 30px;
            border-top: 6px solid var(--accent-gold);
        }

        .login-card h2 {
            color: var(--btn-blue);
            font-size: 1.4em;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .login-card p {
            font-size: 0.9em;
            color: var(--text-muted);
            margin-bottom: 25px;
        }

        .input-group {
            position: relative;
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group input {
            width: 100%;
            padding: 14px 60px 14px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            outline: none;
            transition: 0.2s;
        }

        .input-group input:focus {
            border-color: var(--btn-blue);
        }

        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--btn-blue);
            font-weight: bold;
            font-size: 0.9em;
        }

        .btn-login {
            background: var(--accent-gold);
            color: var(--btn-blue);
            border: none;
            width: 100%;
            padding: 14px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-login:hover {
            filter: brightness(0.95);
        }

        /* =========================================
           2. HALAMAN KUIS (UI PREMIUM CBT)
           ========================================= */
        #quiz-page {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            background: var(--btn-blue);
            color: var(--accent-gold);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.2em;
            font-weight: 700;
            text-transform: uppercase;
        }

        .timer-pill {
            background: #FFFFFF;
            color: var(--text-dark);
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .quiz-container {
            display: flex;
            gap: 20px;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            flex-grow: 1;
            align-items: flex-start;
        }

        /* Left Column: Question Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .question-card {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
            border-top: 2px solid var(--accent-gold);
        }

        .card-header {
            padding: 15px 25px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .soal-indicator {
            color: var(--btn-blue);
            font-weight: 700;
            font-size: 1em;
        }

        .tipe-badge {
            background: var(--accent-gold);
            color: var(--btn-blue);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .card-body {
            padding: 25px;
            min-height: 300px;
        }

        .wacana-box {
            background: #FEF3C7;
            padding: 15px;
            border-left: 4px solid var(--accent-gold);
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .question-text {
            font-size: 1.05em;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .question-text img {
            max-width: 100%;
            border-radius: 8px;
            margin: 10px 0;
            display: block;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-label {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: var(--option-bg);
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid transparent;
        }

        .option-label:hover {
            background: #E5E7EB;
        }

        .option-label input {
            margin-right: 15px;
            transform: scale(1.3);
            accent-color: var(--btn-blue);
        }

        .option-label.selected {
            border-color: var(--btn-blue);
            background: #EBF1FF;
        }

        .card-footer {
            padding: 15px 25px;
            background: #F9FAFB;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-prev {
            background: var(--border-color);
            color: var(--text-dark);
        }

        .btn-next {
            background: var(--btn-blue);
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Right Column: Navigation Grid */
        .sidebar {
            width: 300px;
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            position: relative; /* For Lock Overlay */
            flex-shrink: 0;
        }

        .sidebar h3 {
            color: var(--btn-blue);
            text-align: center;
            font-size: 1em;
            margin-bottom: 10px;
        }

        .sidebar-divider {
            height: 2px;
            background: var(--accent-gold);
            margin-bottom: 20px;
        }

        .cbt-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            opacity: 0.4; /* Lock Effect */
            pointer-events: none;
        }

        .grid-item {
            aspect-ratio: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.9em;
            color: var(--text-dark);
        }

        .grid-item.active {
            background: var(--btn-blue);
            color: white;
            border-color: var(--btn-blue);
        }

        /* Overlay Lock Premium */
        .lock-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            cursor: pointer;
        }
        
        .badge-lock {
            background: rgba(0,0,0,0.75);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            backdrop-filter: blur(2px);
        }

        /* =========================================
           3. HALAMAN HASIL & PAYWALL
           ========================================= */
        #result-page {
            max-width: 800px;
            margin: 40px auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .score-circle {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            background: var(--btn-blue);
            color: var(--accent-gold);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3em;
            font-weight: 900;
            margin: 0 auto 20px;
            border: 6px solid #EBF1FF;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .premium-banner {
            background: linear-gradient(135deg, var(--accent-gold), #F59E0B);
            padding: 25px;
            border-radius: 12px;
            margin: 30px 0;
            color: #78350F;
            border: 2px solid #D97706;
            box-shadow: 0 6px 15px rgba(245, 158, 11, 0.2);
        }

        .btn-upgrade {
            display: inline-block;
            background: #DC2626;
            color: white;
            padding: 16px 32px;
            border-radius: 30px;
            font-size: 1.2em;
            font-weight: 900;
            text-decoration: none;
            margin-top: 20px;
            animation: blinker 1.5s linear infinite;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
            border: 2px solid white;
        }

        @keyframes blinker {
            50% { opacity: 0.8; transform: scale(1.03); }
        }

        .btn-certificate {
            background: #4B5563;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 20px;
        }

        /* Affiliate Section */
        .affiliate-section {
            text-align: left;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px dashed var(--border-color);
        }

        .book-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media(min-width: 600px) {
            .book-grid { grid-template-columns: 1fr 1fr; }
        }

        .book-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            border-left: 4px solid var(--btn-blue);
        }

        .btn-buy {
            display: block;
            text-align: center;
            background: #10B981;
            color: white;
            text-decoration: none;
            padding: 12px;
            border-radius: 6px;
            font-weight: bold;
            margin-top: 15px;
            transition: 0.3s;
        }

        .btn-buy:hover { background: #059669; }

        .copyright-raksasa {
            margin-top: 50px;
            font-size: 1.2em;
            font-weight: 900;
            color: #374151;
            padding: 20px;
            background: var(--bg-light);
            border-radius: 8px;
        }

        /* Responsive Layout */
        @media(max-width: 800px) {
            .quiz-container { flex-direction: column; }
            .sidebar { width: 100%; }
            .card-footer { flex-direction: column-reverse; gap: 10px; }
            .nav-btn { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>

<div id="login-page">
    <div class="login-card">
        <h2 id="display-judul-login">TKA SD - BAHASA INDONESIA</h2>
        <p>Masukkan PIN untuk memulai ujian.</p>
        
        <div class="input-group">
            <input type="password" id="pin-input" placeholder="Masukkan PIN Akses">
            <div class="toggle-password" onclick="togglePassword()">Lihat</div>
        </div>
        
        <button class="btn-login" onclick="startQuiz()">MULAI UJIAN</button>
    </div>
</div>

<div id="quiz-page" class="hidden">
    <div class="header">
        <h1 id="display-judul-quiz">TKA SD - BAHASA INDONESIA</h1>
        <div class="timer-pill" onclick="alertPremium('Timer')">
            ‚è≥ Waktu: Terkunci (Premium)
        </div>
    </div>
    
    <div class="quiz-container">
        <div class="main-content">
            <div class="question-card">
                <div class="card-header">
                    <span class="soal-indicator" id="question-counter">Soal 1 / 30</span>
                    <span class="tipe-badge" id="tipe-soal-badge">Tipe: PG</span>
                </div>
                
                <div class="card-body">
                    <div id="wacana-container" class="wacana-box hidden"></div>
                    <div id="question-text" class="question-text"></div>
                    <div id="options-container" class="options-container"></div>
                </div>

                <div class="card-footer">
                    <button class="nav-btn btn-prev" id="btn-prev" onclick="navQuestion(-1)">‚óÑ Sebelumnya</button>
                    <button class="nav-btn btn-next" id="btn-next" onclick="navQuestion(1)">Soal Selanjutnya ‚ñ∫</button>
                </div>
            </div>
        </div>

        <aside class="sidebar">
            <h3>Navigasi Soal</h3>
            <div class="sidebar-divider"></div>
            
            <div class="lock-overlay" onclick="alertPremium('Lompat Soal / Navigasi Pintar')">
                <div class="badge-lock">üîí Fitur Premium</div>
            </div>
            
            <div id="cbt-grid" class="cbt-grid"></div>
        </aside>
    </div>
</div>

<div id="result-page" class="hidden">
    <h2>Hasil Ujian Trial</h2>
    <div class="score-circle" id="final-score">0</div>
    
    <button class="btn-certificate" onclick="alertPremium('Cetak Sertifikat')">
        üñ®Ô∏è Cetak Sertifikat üîí
    </button>

    <div class="premium-banner">
        <h3 style="margin-bottom:10px; font-size:1.4em; color:#92400E;">Hebat! Kamu telah menyelesaikan versi Trial.</h3>
        <p>Ingin akses ke <b>RATUSAN</b> soal berkualitas TKA, fitur Timer, Navigasi Pintar, Pembahasan Lengkap, dan Cetak Sertifikat? Buka potensi belajarmu sekarang!</p>
        <a href="#" id="link-premium" class="btn-upgrade" target="_blank">üöÄ UPGRADE KE PREMIUM SEKARANG</a>
    </div>

    <div class="affiliate-section">
        <h3 style="color:var(--btn-blue);">üìö Rekomendasi Buku Belajar Pilihan</h3>
        <div class="book-grid">
            <div class="book-card">
                <h4 id="buku1-judul" style="color:var(--btn-blue); margin-bottom:8px;"></h4>
                <p id="buku1-desc" style="color:var(--text-muted); font-size:0.9em; flex-grow:1;"></p>
                <a href="#" id="buku1-link" class="btn-buy" target="_blank">üõí Beli Buku Ini</a>
            </div>
            <div class="book-card">
                <h4 id="buku2-judul" style="color:var(--btn-blue); margin-bottom:8px;"></h4>
                <p id="buku2-desc" style="color:var(--text-muted); font-size:0.9em; flex-grow:1;"></p>
                <a href="#" id="buku2-link" class="btn-buy" target="_blank">üõí Beli Buku Ini</a>
            </div>
        </div>
    </div>

    <div class="copyright-raksasa">
        ¬© 2026 Copyright "Belajar Sukses". All Rights Reserved.
    </div>
</div>

<script>
    // ==========================================
    // 1. KONFIGURASI DATA (FLEKSIBEL)
    // ==========================================
    const JUDUL_KUIS = "TKA SD - BAHASA INDONESIA";
    const PIN_AKSES = "COBA123";
    const TARGET_TOTAL_SOAL = 15;

    // Link Jualan Produk Digital
    const LINK_PEMBELIAN_PREMIUM = "https://lynk.id/belajarsukses";

    // Data Affiliate Buku Fisik
    const BUKU_1_JUDUL = "Buku Super Drilling TKA SD/MI";
    const BUKU_1_DESC = "Kumpulan soal terlengkap dengan pembahasan jitu untuk persiapan ujian.";
    const BUKU_1_LINK = "https://shope.ee/contohlink_buku1";

    const BUKU_2_JUDUL = "Buku Taktik Cerdik Lulus TKA";
    const BUKU_2_DESC = "Berisi ringkasan materi dan life hack cara cepat menjawab soal.";
    const BUKU_2_LINK = "https://shope.ee/contohlink_buku2";

    // Data Soal Mentah
    const RAW_SINGLE = `
[Tipe: PG] "Kemarin sore aku antri cukup lama saat membeli tiket di stasiun," kata paman. Penggunaan kata tidak baku dalam kalimat dialog tersebut jika diperbaiki menjadi kata baku adalah... | Antre ~ Mengantri ~ Antrian ~ Ngantri | A | Kata baku yang benar sesuai Pedoman Umum Ejaan Bahasa Indonesia (PUEBI) adalah "antre".
[Tipe: PG] Di sebuah ekosistem laut yang asri, terdapat terumbu karang yang menjadi rumah bagi berbagai **biota**. Apa makna istilah biologi yang dicetak tebal tersebut? | Sekumpulan tumbuhan laut ~ Seluruh flora dan fauna di wilayah tertentu ~ Jenis ikan hias yang langka ~ Batuan yang ada di dasar laut | B | Biota merujuk pada keseluruhan kehidupan (flora dan fauna) di suatu wilayah. 
[Tipe: PG] Perjalanan dari Jakarta ke Bandung kini lebih cepat berkat adanya kereta cepat. Transportasi **modern** ini sangat diminati masyarakat. Sinonim kata "*modern*" pada kalimat tersebut adalah... | Canggih ~ Lawas ~ Tradisional ~ Terkenal | A | Modern dalam konteks transportasi merujuk pada teknologi yang canggih atau terbaru. 
[Tipe: PG] Pak Budi adalah **tangan kanan** direktur di perusahaan itu. Makna ungkapan "**tangan kanan**" adalah... | Orang yang kuat ~ Orang kepercayaan ~ Anggota keluarga ~ Orang yang rajin | B | Tangan kanan adalah idiom untuk orang yang sangat dipercaya oleh atasan. 
[Tipe: PG] Teks cerita misteri: "Keesokan paginya, kotak kayu rahasia di atas meja kakek ternyata telah terbuka gemboknya. Namun, isinya bukanlah tumpukan koin emas seperti yang kuduga selama ini, melainkan secarik peta tua kumal dengan tanda silang merah berdarah di ujungnya." Kalimat manakah yang paling memancing rasa penasaran pembaca dari kutipan tersebut? | Keesokan paginya, kotak kayu rahasia di atas meja kakek telah terbuka ~ Kotak kayu misterius itu berada di atas meja ~ Isinya bukanlah tumpukan koin emas seperti yang kuduga ~ Terdapat secarik peta tua kumal dengan tanda silang merah berdarah di ujungnya | D | Peta yang memiliki tanda spesifik (silang merah) memberikan petunjuk adanya teka-teki baru, membuat pembaca bertanya-tanya arah petualangan selanjutnya.
[Tipe: PGK] Manakah kelompok kata di bawah ini yang seluruhnya termasuk dalam kosakata bidang olahraga sepak bola? | Gawang ~ Penalti ~ Kok ~ Servis | A, B | Gawang dan penalti adalah istilah dalam sepak bola. Kok dan servis adalah istilah dalam bulu tangkis/tenis.
[Tipe: PG] Aku adalah salah satu benda langit yang bercahaya. Aku memancarkan cahayaku sendiri yang sangat panas dan aku menjadi pusat tata surya. Benda langit apakah aku? | Bumi ~ Bulan ~ Bintang ~ Matahari | D | Matahari adalah bintang yang menjadi pusat tata surya dan memancarkan cahayanya sendiri.
    `;

    const RAW_CLUSTER = `
###
[WACANA: Keajaiban Metamorfosis Katak] Katak merupakan hewan amfibi yang mengalami siklus hidup unik. Proses ini diawali dari telur yang diletakkan induknya di dalam air. Setelah beberapa hari, telur menetas menjadi kecebong atau berudu yang bernapas dengan insang. Seiring berjalannya waktu, pada kecebong tumbuh kaki belakang, disusul kaki depan, dan ekornya mulai memendek hingga terbentuklah katak muda. Akhirnya, katak muda tumbuh menjadi katak dewasa yang bernapas menggunakan paru-paru dan kulit.
[Tipe: BS] Tentukan benar atau salah pernyataan mengenai siklus hidup katak berdasarkan teks: | Kecebong bernapas menggunakan paru-paru (Salah) ~ Kaki depan tumbuh lebih dulu daripada kaki belakang (Salah) ~ Katak dewasa bernapas dengan paru-paru dan kulit (Benar) | - | Kecebong menggunakan insang, kaki belakang tumbuh lebih dulu, dan dewasa menggunakan paru-paru/kulit. 
[Tipe: PG] [IMG: https://i.ibb.co.com/Psz3GG0n/Gemini-Generated-Image-9b5iel9b5iel9b5i.png] Bagian diagram yang kosong setelah fase "Telur" dan sebelum "Katak Muda" seharusnya diisi dengan... | Katak Dewasa ~ Kecebong ~ Telur Ikan ~ Kepompong | B | Setelah telur menetas, fase berikutnya dalam metamorfosis katak adalah kecebong/berudu. 
###
    `;

    // ==========================================
    // 2. ENGINE DASAR & PARSER
    // ==========================================
    let questionsData = [];
    let currentIndex = 0;
    let userAnswers = {};

    function parseMarkdown(text) {
        text = text.replace(/^\d+\.\s*/, '');
        return text
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.*?)\*/g, '<em>$1</em>')
            .replace(/<br>/g, '<br>')
            .replace(/\[IMG:\s*(.*?)\]/g, '<img src="$1" alt="Gambar Soal">');
    }

    function extractQuestions(rawSingle, rawCluster) {
        let tempQuestions = [];

        // Parse Single
        const singleMatches = rawSingle.match(/\[Tipe:\s*([A-Z]+)\](.*?)\|(.*?)\|(.*?)\|/g);
        if(singleMatches) {
            singleMatches.forEach(match => {
                const parts = match.split('|');
                tempQuestions.push({
                    type: parts[0].match(/\[Tipe:\s*([A-Z]+)\]/)[1],
                    wacana: null,
                    text: parseMarkdown(parts[0].replace(/\[Tipe:\s*[A-Z]+\]/, '').trim()),
                    options: parts[1].trim().split('~').map(o => parseMarkdown(o.trim())),
                    correctKey: parts[2].trim()
                });
            });
        }

        // Parse Cluster
        const clusters = rawCluster.split('###').filter(c => c.trim() !== '');
        clusters.forEach(cluster => {
            const wacanaMatch = cluster.match(/\[WACANA:(.*?)\](.*?)(\[Tipe:|$)/s);
            let wacanaHTML = null;
            if(wacanaMatch) {
                wacanaHTML = `<strong>${wacanaMatch[1].trim()}</strong><br>${parseMarkdown(wacanaMatch[2].trim())}`;
            }

            const clusterMatches = cluster.match(/\[Tipe:\s*([A-Z]+)\](.*?)\|(.*?)\|(.*?)\|/g);
            if(clusterMatches) {
                clusterMatches.forEach(match => {
                    const parts = match.split('|');
                    tempQuestions.push({
                        type: parts[0].match(/\[Tipe:\s*([A-Z]+)\]/)[1],
                        wacana: wacanaHTML,
                        text: parseMarkdown(parts[0].replace(/\[Tipe:\s*[A-Z]+\]/, '').trim()),
                        options: parts[1].trim().split('~').map(o => parseMarkdown(o.trim())),
                        correctKey: parts[2].trim()
                    });
                });
            }
        });

        // Duplikasi untuk simulasi jumlah soal TARGET_TOTAL_SOAL (Mencegah error jika data kurang)
        while(tempQuestions.length < TARGET_TOTAL_SOAL) {
            tempQuestions.push(tempQuestions[0]);
        }
        return tempQuestions.slice(0, TARGET_TOTAL_SOAL);
    }

    // ==========================================
    // 3. LOGIKA UI & INTERAKSI
    // ==========================================
    function initApp() {
        document.getElementById('display-judul-login').innerText = JUDUL_KUIS;
        document.getElementById('display-judul-quiz').innerText = JUDUL_KUIS;
        
        document.getElementById('link-premium').href = LINK_PEMBELIAN_PREMIUM;
        document.getElementById('buku1-judul').innerText = BUKU_1_JUDUL;
        document.getElementById('buku1-desc').innerText = BUKU_1_DESC;
        document.getElementById('buku1-link').href = BUKU_1_LINK;
        document.getElementById('buku2-judul').innerText = BUKU_2_JUDUL;
        document.getElementById('buku2-desc').innerText = BUKU_2_DESC;
        document.getElementById('buku2-link').href = BUKU_2_LINK;

        questionsData = extractQuestions(RAW_SINGLE, RAW_CLUSTER);
    }

    function togglePassword() {
        const input = document.getElementById('pin-input');
        const toggleBtn = document.querySelector('.toggle-password');
        if(input.type === 'password') {
            input.type = 'text';
            toggleBtn.innerText = 'Sembunyikan';
        } else {
            input.type = 'password';
            toggleBtn.innerText = 'Lihat';
        }
    }

    function alertPremium(feature) {
        alert(`Buka versi Premium untuk fitur ${feature}!`);
    }

    function startQuiz() {
        const pin = document.getElementById('pin-input').value;
        if(pin !== PIN_AKSES) {
            alert("PIN Akses salah! (Gunakan: COBA123)");
            return;
        }
        
        document.getElementById('login-page').classList.add('hidden');
        document.getElementById('quiz-page').classList.remove('hidden');
        
        renderGrid();
        showQuestion(0);
    }

    function renderGrid() {
        const gridContainer = document.getElementById('cbt-grid');
        gridContainer.innerHTML = '';
        for(let i = 0; i < questionsData.length; i++) {
            const item = document.createElement('div');
            item.className = 'grid-item';
            item.id = `grid-btn-${i}`;
            item.innerText = i + 1;
            gridContainer.appendChild(item);
        }
    }

    function showQuestion(index) {
        if(index < 0 || index >= questionsData.length) return;
        currentIndex = index;
        const q = questionsData[index];

        // Header Update
        document.getElementById('question-counter').innerText = `Soal ${index + 1} / ${questionsData.length}`;
        document.getElementById('tipe-soal-badge').innerText = `Tipe: ${q.type}`;

        // Update Grid UI (Even if locked, highlight current)
        document.querySelectorAll('.grid-item').forEach(el => el.classList.remove('active'));
        document.getElementById(`grid-btn-${index}`).classList.add('active');

        // Wacana & Text
        const wacanaBox = document.getElementById('wacana-container');
        if(q.wacana) {
            wacanaBox.innerHTML = q.wacana;
            wacanaBox.classList.remove('hidden');
        } else {
            wacanaBox.classList.add('hidden');
        }
        document.getElementById('question-text').innerHTML = q.text;

        // Opsi
        const optContainer = document.getElementById('options-container');
        optContainer.innerHTML = '';
        const alphabet = ['A', 'B', 'C', 'D', 'E'];
        
        q.options.forEach((optText, i) => {
            const label = document.createElement('label');
            label.className = 'option-label';
            
            const input = document.createElement('input');
            input.name = `soal_${index}`;
            
            if(q.type === 'PGK') {
                input.type = 'checkbox';
                input.value = alphabet[i];
                if(userAnswers[index] && userAnswers[index].includes(alphabet[i])) {
                    input.checked = true;
                    label.classList.add('selected');
                }
            } else if (q.type === 'BS') {
                input.type = 'radio';
                input.value = optText; 
                if(userAnswers[index] === optText) {
                    input.checked = true;
                    label.classList.add('selected');
                }
            } else {
                input.type = 'radio';
                input.value = alphabet[i];
                if(userAnswers[index] === alphabet[i]) {
                    input.checked = true;
                    label.classList.add('selected');
                }
            }

            input.addEventListener('change', (e) => saveAnswer(index, q.type, e.target));
            label.appendChild(input);
            label.innerHTML += q.type === 'BS' ? optText : `<b>${alphabet[i]}.</b>&nbsp;&nbsp;${optText}`;
            optContainer.appendChild(label);
        });

        // Tombol Navigasi
        document.getElementById('btn-prev').style.visibility = index === 0 ? 'hidden' : 'visible';
        const btnNext = document.getElementById('btn-next');
        if(index === questionsData.length - 1) {
            btnNext.innerHTML = 'Selesai Ujian ‚úîÔ∏è';
            btnNext.onclick = finishQuiz;
            btnNext.style.background = '#10B981';
        } else {
            btnNext.innerHTML = 'Soal Selanjutnya ‚ñ∫';
            btnNext.onclick = () => navQuestion(1);
            btnNext.style.background = 'var(--btn-blue)';
        }
    }

    function saveAnswer(index, type, target) {
        if(type === 'PGK') {
            if(!userAnswers[index]) userAnswers[index] = [];
            if(target.checked) {
                userAnswers[index].push(target.value);
            } else {
                userAnswers[index] = userAnswers[index].filter(v => v !== target.value);
            }
        } else {
            userAnswers[index] = target.value;
        }

        const labels = document.querySelectorAll('.option-label');
        if(type !== 'PGK') labels.forEach(l => l.classList.remove('selected'));
        if(target.checked) target.parentElement.classList.add('selected');
        else target.parentElement.classList.remove('selected');
    }

    function navQuestion(dir) {
        showQuestion(currentIndex + dir);
    }

    function finishQuiz() {
        if(!confirm("Yakin ingin menyelesaikan ujian Demo ini?")) return;
        
        let correctCount = 0;
        let totalPG = 0;
        questionsData.forEach((q, i) => {
            if(q.type === 'PG') {
                totalPG++;
                if(userAnswers[i] === q.correctKey) correctCount++;
            }
        });
        
        const score = Math.round((correctCount / (totalPG || 1)) * 100);
        document.getElementById('final-score').innerText = score;

        document.getElementById('quiz-page').classList.add('hidden');
        document.getElementById('result-page').classList.remove('hidden');
        document.body.style.backgroundColor = "var(--bg-light)";
    }

    window.onload = initApp;
</script>

</body>
</html>
